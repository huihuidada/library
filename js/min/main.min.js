var all,session=getSession();function getSession(){return window.location.search.substr(9)}window.onload=function(){var e;$.ajax({type:"GET",url:"http://api.xiyoumobile.com/xiyoulibv2/user/info",dataType:"jsonp",jsonpCallback:"handleResponse",data:{session:session},success:function(o){var t=o.Result;(e=o.Detail,t)&&$(".info").text(e.Department+" "+e.Name)}}),all=15,$.ajax({type:"GET",dataType:"jsonp",url:"http://api.xiyoumobile.com/xiyoulibv2/user/rent",data:{session:session},success:function(o){var t=o.Result,e=o.Detail;if(console.log(o),t){var a="",s=0,i=0,n=0,c=0;if("NO_RECORD"==e)n=all-s,$(".blue").html(s),$(".red").html(i),$(".green").html(n),$(".yellow").html(c);else{$.each(e,function(o,t){switch(s++,t.State){case"本馆续借":i++;break;case"过期暂停":c++}t.CanRenew?a+="<div class='book'><div class='bookContent'><p class='book_name'>"+t.Title+"</p><p class='book_time'>到期时间："+t.Date+"</p><div class='button_reborrow' nameid="+t.Barcode+">我要续借</div></div></div>":a+="<div class='book'><div class='bookContent'><p class='book_name'>"+t.Title+"</p><p class='book_time'>到期时间："+t.Date+"</p><p class='book_state'>状态：<span class='book_stateName'>本馆续借</span></p></div></div>"}),$(".borrow_list").html(a),n=all-s,$(".blue").html(s),$(".red").html(i),$(".green").html(n),$(".yellow").html(c);var l=[],r=$(".button_reborrow");$.each(e,function(o,t){l[o]={session:session,department_id:t.Department_id,library_id:t.Library_id}}),$.each(r,function(a,o){$(this).click(function(e){var o=e.target.getAttribute("nameid"),t=l[a];t.barcode=o,$.ajax({type:"GET",url:"http://api.xiyoumobile.com/xiyoulibv2/user/renew",dataType:"jsonp",data:t,success:function(o){if(o.Result){var t=o.Detail;$(e.target).parent().find("p").eq(1).replaceWith("<p class='book_time'>到期时间："+t+"</p>"),$(e.target).replaceWith("<p class='book_state'>状态：<span class='book_stateName'>本馆续借</span></p>")}}})})})}}}}),$(".button_borrow a").click(function(){$(".button_book a").css("background-color","white"),$(".button_borrow a").css("background-color","rgb(234,227,234)"),$(".search_content").css("display","none"),$(".content").css("display","block")}),$(".button_book a").click(function(){$(".button_borrow a").css("background-color","white"),$(".button_book a").css("background-color","rgb(234,227,234)"),$(".content").css("display","none"),$(".search_content").css("display","block")}),$(".search_submit").click(function(){var o=$(".search_text").val();o?$.ajax({type:"GET",url:"http://api.xiyoumobile.com/xiyoulibv2/book/search",dataType:"jsonp",data:{keyword:o},success:function(o){var e="",t=o.Detail.BookData;o.Detail.Amount?$.each(t,function(o,t){e+="<div class='book'><div class='bookContent'><div class='book_name1'><a href='#moreInfo' code=' "+t.ID+"'>"+t.Title+"</a></div></div></div>"}):e="未查到相关信息",$(".search_book").html(e);var a=$(".book_name1 a");$.each(a,function(o,t){$(this).click(function(o){var t=o.target.getAttribute("code");window.location.href="moreInfo.html?id="+t+"$session="+session})})}}):$(".search_book").html("搜索内容为空")})};